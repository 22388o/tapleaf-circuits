<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, user-scalable=no">
        <script src="https://bundle.run/noble-secp256k1@1.2.14"></script>
        <script src="https://unpkg.com/@cmdcode/tapscript@1.4.1"></script>
        <style>
            * {
                box-sizing: border-box;
                font-size: 1.15rem;
                font-family: Arial, sans-serif;
            }
            html {
                max-width: 70ch;
                padding: 3rem 1rem;
                margin: auto;
                line-height: 1.25;
            }
            h1 {
                font-size: 2rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            input {
                line-height: 1.25;
                width: 100%;
                height: 1.8rem;
                font-size: 1.15rem;
                border: 1px solid grey;
            }
            .hidden {
                display: none;
            }
            .program {
                word-break: break-word;
            }
            .p_buttons {
                margin: 0.5rem;
            }
            @media screen and (max-width: 600px) {
            }
        </style>
        <script>
            var $ = document.querySelector.bind( document );
            var $$ = document.querySelectorAll.bind( document );
            var url_params = new URLSearchParams( window.location.search );
            var url_keys = url_params.keys();
            var $_GET = {}
            for ( var key of url_keys ) $_GET[ key ] = url_params.get( key );
        </script>
        <script>
            var sha256 = s => {
                if ( typeof s == "string" ) s = new TextEncoder().encode( s );
                return crypto.subtle.digest( 'SHA-256', s ).then( hashBuffer => {
                    var hashArray = Array.from( new Uint8Array( hashBuffer ) );
                    var hashHex = hashArray
                        .map( bytes => bytes.toString( 16 ).padStart( 2, '0' ) )
                        .join( '' );
                    return hashHex;
                });
            }

            function hexToBytes( hex ) {
                return Uint8Array.from( hex.match( /.{1,2}/g ).map( ( byte ) => parseInt( byte, 16 ) ) );
            }

            function bytesToHex( bytes ) {
                return bytes.reduce( ( str, byte ) => str + byte.toString( 16 ).padStart( 2, "0" ), "" );
            }

            var getRand = size => bytesToHex(crypto.getRandomValues(new Uint8Array(size)));

            var AND = ( a, b ) => Number( a && b );
            var XOR = ( a, b ) => Number( a ^ b );
            var INV = ( a ) => Number( !a );

            function removeDuplicates(arr) {
                var copy = JSON.parse( JSON.stringify( arr ) );
                return copy.filter((item,index) => copy.indexOf(item) === index);
            }

            var compareTapleaves = async ( preimage, challenge_scripts ) => {
                var scripts_this_preimage_is_referenced_in = [];
                var hash = await sha256( hexToBytes( preimage ) );
                challenge_scripts.forEach( ( script, index ) => {
                    script.forEach( element => {
                        if ( element == hash ) scripts_this_preimage_is_referenced_in.push( index );
                    });
                });
                return scripts_this_preimage_is_referenced_in;
            }

            var discardUnusedPreimages = async () => {
                var i; for ( i=0; i<preimages_from_paul.length; i++ ) {
                    var preimage = preimages_from_paul[ i ];
                    var tapleaves_it_is_in = await compareTapleaves( preimage, challenge_scripts );
                    if ( tapleaves_it_is_in.length ) continue;
                    preimages_from_paul.splice( i, 1 );
                    i = i - 1;
                }
            }

            var OP_NOT = async ( input_preimage, expected_input_hash, input_value, output_preimage, expected_output_hash, output_value ) => {
                var real_input_hash = await sha256( hexToBytes( input_preimage ) );
                if ( real_input_hash != expected_input_hash ) return `you cannot spend with this tapleaf`;
                var input_bit = input_value;
                input_bit = Number( !input_bit );
                var real_output_hash = await sha256( hexToBytes( output_preimage ) );
                if ( real_output_hash != expected_output_hash ) return `you cannot spend with this tapleaf`;
                var output_bit = output_value;
                if ( input_bit != output_bit ) return `you can spend with these preimages: ${input_preimage} as the input preimage and ${output_preimage} as the output preimage`;
                return `you cannot spend with this tapleaf`;
            }

            var OP_BOOLAND = async ( first_input_preimage, first_expected_input_hash, first_input_value, second_input_preimage, second_expected_input_hash, second_input_value, output_preimage, expected_output_hash, output_value ) => {
                var real_first_input_hash = await sha256( hexToBytes( first_input_preimage ) );
                if ( real_first_input_hash != first_expected_input_hash ) return `you cannot spend with this tapleaf`;
                var real_second_input_hash = await sha256( hexToBytes( second_input_preimage ) );
                if ( real_second_input_hash != second_expected_input_hash ) return `you cannot spend with this tapleaf`;
                var comparison_bit = Number( first_input_value && second_input_value );
                var real_output_hash = await sha256( hexToBytes( output_preimage ) );
                if ( real_output_hash != expected_output_hash ) return `you cannot spend with this tapleaf`;
                var output_bit = output_value;
                if ( comparison_bit != output_bit ) return `you can spend with these preimages: ${first_input_preimage} as the first input preimage, ${second_input_preimage} as the second, and ${output_preimage} as the output preimage`;
                return `you cannot spend with this tapleaf`;
            }

            var OP_XOR = async ( first_input_preimage, first_expected_input_hash, first_input_value, second_input_preimage, second_expected_input_hash, second_input_value, output_preimage, expected_output_hash, output_value ) => {
                var real_first_input_hash = await sha256( hexToBytes( first_input_preimage ) );
                if ( real_first_input_hash != first_expected_input_hash ) return `you cannot spend with this tapleaf`;
                var real_second_input_hash = await sha256( hexToBytes( second_input_preimage ) );
                if ( real_second_input_hash != second_expected_input_hash ) return `you cannot spend with this tapleaf`;
                var comparison_bit = Number( first_input_value ^ second_input_value );
                var real_output_hash = await sha256( hexToBytes( output_preimage ) );
                if ( real_output_hash != expected_output_hash ) return `you cannot spend with this tapleaf`;
                var output_bit = output_value;
                if ( comparison_bit != output_bit ) return `you can spend with these preimages: ${first_input_preimage} as the first input preimage, ${second_input_preimage} as the second, and ${output_preimage} as the output preimage`;
                return `you cannot spend with this tapleaf`;
            }

            var makeBristolArray = () => {
                arr = arrprep.split( `\n`);
                arr.forEach( ( entry, index ) => {
                    arr[ index ] = arr[ index ].replace( / +(?= )/g, "" );
                    if ( entry.startsWith( " " ) ) arr[ index ] = arr[ index ].substring( 1 );
                });
                if ( !arr[ 0 ] ) arr.splice( 0, 1 );
                if ( !arr[ arr.length - 1 ] ) arr.splice( arr.length - 1, 1 );
                if ( arr[ 3 ] ) alert( "Oops, you entered an invalid bristol circuit! Try again with the whole document, including the first three lines that define the number of gates, number of input bits, and number of output bits." );
                number_of_preimages_to_expect = arr[ 0 ].split( " " ).filter( item => item )[ 1 ];
                number_of_preimages_to_expect = Number( number_of_preimages_to_expect );
                number_of_inputs = arr[ 1 ].split( " " ).filter( item => item )[ 1 ];
                number_of_inputs = Number( number_of_inputs );
                number_of_outputs = arr[ 2 ].split( " " ).filter( item => item )[ 1 ];
                number_of_outputs = Number( number_of_outputs );
                arr.splice( 0, 4 );
            }

            setOperationsArray = async () => {
                var index; for ( index=0; index<arr.length; index++ ) {
                    var gate = arr[ index ].split( " " ).filter( item => item );
                    if ( gate[ gate.length - 1 ] == "INV" ) {
                        if ( !wire_settings[ gate[ 2 ] ] ) {
                            var input_preimage_0 = getRand( 32 );
                            var input_preimage_1 = getRand( 32 );
                            wire_settings[ gate[ 2 ] ] = [input_preimage_0, input_preimage_1];
                        } else {
                            var input_preimage_0 = wire_settings[ gate[ 2 ] ][ 0 ];
                            var input_preimage_1 = wire_settings[ gate[ 2 ] ][ 1 ];
                        }
                        var output_preimage_0 = getRand( 32 );
                        var output_preimage_1 = getRand( 32 );
                        var input_hash_0 = await sha256( hexToBytes( input_preimage_0 ) );
                        var input_hash_1 = await sha256( hexToBytes( input_preimage_1 ) );
                        var output_hash_0 = await sha256( hexToBytes( output_preimage_0 ) );
                        var output_hash_1 = await sha256( hexToBytes( output_preimage_1 ) );
                        wire_settings[ gate[ 3 ] ] = [output_preimage_0, output_preimage_1];
                        operations_array.push( ["INV", ["input_preimages", input_preimage_0, input_preimage_1], ["output_preimages", output_preimage_0, output_preimage_1], ["input_hashes", input_hash_0, input_hash_1], ["output_hashes", output_hash_0, output_hash_1], `var w_${gate[ 3 ]} = INV( wires[ ${gate[ 2 ]} ] )`] );
                    }
                    if ( gate[ gate.length - 1 ] == "AND" ) {
                        if ( !wire_settings[ gate[ 2 ] ] ) {
                            var first_input_preimage_0 = getRand( 32 );
                            var first_input_preimage_1 = getRand( 32 );
                            wire_settings[ gate[ 2 ] ] = [first_input_preimage_0, first_input_preimage_1];
                        } else {
                            var first_input_preimage_0 = wire_settings[ gate[ 2 ] ][ 0 ];
                            var first_input_preimage_1 = wire_settings[ gate[ 2 ] ][ 1 ];
                        }
                        if ( !wire_settings[ gate[ 3 ] ] ) {
                            var second_input_preimage_0 = getRand( 32 );
                            var second_input_preimage_1 = getRand( 32 );
                            wire_settings[ gate[ 3 ] ] = [second_input_preimage_0, second_input_preimage_1];
                        } else {
                            var second_input_preimage_0 = wire_settings[ gate[ 3 ] ][ 0 ];
                            var second_input_preimage_1 = wire_settings[ gate[ 3 ] ][ 1 ];
                        }
                        var output_preimage_0 = getRand( 32 );
                        var output_preimage_1 = getRand( 32 );
                        var first_input_hash_0 = await sha256( hexToBytes( first_input_preimage_0 ) );
                        var first_input_hash_1 = await sha256( hexToBytes( first_input_preimage_1 ) );
                        var second_input_hash_0 = await sha256( hexToBytes( second_input_preimage_0 ) );
                        var second_input_hash_1 = await sha256( hexToBytes( second_input_preimage_1 ) );
                        var output_hash_0 = await sha256( hexToBytes( output_preimage_0 ) );
                        var output_hash_1 = await sha256( hexToBytes( output_preimage_1 ) );
                        wire_settings[ gate[ 4 ] ] = [output_preimage_0, output_preimage_1];
                        operations_array.push( ["AND", ["first_input_preimages", first_input_preimage_0, first_input_preimage_1], ["second_input_preimages", second_input_preimage_0, second_input_preimage_1], ["output_preimages", output_preimage_0, output_preimage_1], ["first_input_hashes", first_input_hash_0, first_input_hash_1], ["second_input_hashes", second_input_hash_0, second_input_hash_1], ["output_hashes", output_hash_0, output_hash_1], `var w_${gate[ 4 ]} = AND( wires[ ${gate[ 2 ]} ], wires[ ${gate[ 3 ]} ] )`] );
                    }
                    if ( gate[ gate.length - 1 ] == "XOR" ) {
                        if ( !wire_settings[ gate[ 2 ] ] ) {
                            var first_input_preimage_0 = getRand( 32 );
                            var first_input_preimage_1 = getRand( 32 );
                            wire_settings[ gate[ 2 ] ] = [first_input_preimage_0, first_input_preimage_1];
                        } else {
                            var first_input_preimage_0 = wire_settings[ gate[ 2 ] ][ 0 ];
                            var first_input_preimage_1 = wire_settings[ gate[ 2 ] ][ 1 ];
                        }
                        if ( !wire_settings[ gate[ 3 ] ] ) {
                            var second_input_preimage_0 = getRand( 32 );
                            var second_input_preimage_1 = getRand( 32 );
                            wire_settings[ gate[ 3 ] ] = [second_input_preimage_0, second_input_preimage_1];
                        } else {
                            var second_input_preimage_0 = wire_settings[ gate[ 3 ] ][ 0 ];
                            var second_input_preimage_1 = wire_settings[ gate[ 3 ] ][ 1 ];
                        }
                        var output_preimage_0 = getRand( 32 );
                        var output_preimage_1 = getRand( 32 );
                        var first_input_hash_0 = await sha256( hexToBytes( first_input_preimage_0 ) );
                        var first_input_hash_1 = await sha256( hexToBytes( first_input_preimage_1 ) );
                        var second_input_hash_0 = await sha256( hexToBytes( second_input_preimage_0 ) );
                        var second_input_hash_1 = await sha256( hexToBytes( second_input_preimage_1 ) );
                        var output_hash_0 = await sha256( hexToBytes( output_preimage_0 ) );
                        var output_hash_1 = await sha256( hexToBytes( output_preimage_1 ) );
                        wire_settings[ gate[ 4 ] ] = [output_preimage_0, output_preimage_1];
                        operations_array.push( ["XOR", ["first_input_preimages", first_input_preimage_0, first_input_preimage_1], ["second_input_preimages", second_input_preimage_0, second_input_preimage_1], ["output_preimages", output_preimage_0, output_preimage_1], ["first_input_hashes", first_input_hash_0, first_input_hash_1], ["second_input_hashes", second_input_hash_0, second_input_hash_1], ["output_hashes", output_hash_0, output_hash_1], `var w_${gate[ 4 ]} = XOR( wires[ ${gate[ 2 ]} ], wires[ ${gate[ 3 ]} ] )`] );
                    }
                }
            }

            var generateBitCommitments = async () => {
                var i; for ( i=0; i<64; i++ ) {
                    initial_commitment_preimages.push( wire_settings[ String( i ) ] );
                    var preimage_0 = wire_settings[ String( i ) ][ 0 ];
                    var preimage_1 = wire_settings[ String( i ) ][ 1 ];
                    var hash_0 = await sha256( hexToBytes( preimage_0 ) );
                    var hash_1 = await sha256( hexToBytes( preimage_1 ) );
                    initial_commitment_hashes.push( [ hash_0, hash_1 ] );
                }
            }

            function saveData( data, fileName ) {
                var a = document.createElement("a");
                document.body.appendChild(a);
                a.style = "display: none";
                var blob = new Blob([data], {type: "octet/stream"}),
                url = window.URL.createObjectURL(blob);
                a.href = url;
                a.download = fileName;
                a.click();
                window.URL.revokeObjectURL(url);
            }

            var generateBitCommitmentAddress = pubkey => {
                var leaf1 = [
                    "OP_10",
                    "OP_CHECKSEQUENCEVERIFY",
                    "OP_DROP",
                    vickys_key,
                    "OP_CHECKSIG"
                ];

                var leaf2 = [
                    "OP_0",
                    pubkey,
                    "OP_CHECKSIGADD",
                    vickys_key,
                    "OP_CHECKSIGADD",
                    "OP_2",
                    "OP_EQUAL"
                ];

                var bit_commitment_template = `
                    OP_SHA256
                    INSERT_16_BYTE_HERE
                    OP_EQUAL
                    OP_SWAP
                    OP_SHA256
                    INSERT_17_BYTE_HERE
                    OP_EQUAL
                    OP_BOOLOR
                    OP_VERIFY
                `;

                var bit_commitment_script = ``;

                initial_commitment_hashes.forEach( hash_pair => {
                    bit_commitment_script += bit_commitment_template.replace( "INSERT_16_BYTE_HERE", hash_pair[ 0 ] ).replace( "INSERT_17_BYTE_HERE", hash_pair[ 1 ] );
                });

                subsequent_commitment_hashes.forEach( hash_pair => {
                    bit_commitment_script += bit_commitment_template.replace( "INSERT_16_BYTE_HERE", hash_pair[ 0 ] ).replace( "INSERT_17_BYTE_HERE", hash_pair[ 1 ] );
                });

                bit_commitment_script += `
                   ${pubkey}
                   OP_CHECKSIG
                `;

                // bit_commitment_script += `
                    // OP_1
                // `;

                var bit_commitment_script_array = bit_commitment_script.replaceAll( "\n\n", "\n" ).replaceAll( " ", "" ).split( "\n" );
                bit_commitment_script_array.splice( 0, 1 );
                bit_commitment_script_array.splice( bit_commitment_script_array.length - 1, 1 );

                var leaf3 = bit_commitment_script_array;

                var scripts = [leaf1, leaf2, leaf3];
                var tree = scripts.map( s => tapscript.Tap.encodeScript( s ) );
                var selected_script = scripts[ 2 ];
                bit_commitment_script = selected_script;
                commitment_to_anywhere_else_script = scripts[ 1 ];
                bit_commitment_tapleaf = tapscript.Tap.encodeScript( bit_commitment_script );
                commitment_to_anywhere_else_tapleaf = tapscript.Tap.encodeScript( commitment_to_anywhere_else_script );
                var target = tapscript.Tap.encodeScript( selected_script );
                var pubkey = "ab".repeat( 32 );
                var [ tpubkey, cblock ] = tapscript.Tap.getPubKey(pubkey, { tree, target });
                bit_commitment_tpubkey = tpubkey;
                bit_commitment_cblock = cblock;
                var [ tpubkey, alt_cblock ] = tapscript.Tap.getPubKey(pubkey, { tree, commitment_to_anywhere_else_tapleaf });
                commitment_to_anywhere_else_cblock = alt_cblock;
                var bit_commitment_address = tapscript.Address.p2tr.fromPubKey( tpubkey, network );
                return bit_commitment_address;
            }

            var generateAntiContradictionAddress = pubkey => {
                var anti_contradiction_template = `
                    OP_SHA256
                    INSERT_16_BYTE_HERE
                    OP_EQUALVERIFY
                    OP_SHA256
                    INSERT_17_BYTE_HERE
                    OP_EQUALVERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;

                var anti_contradiction_scripts = [];

                initial_commitment_hashes.forEach( hash_pair => {
                    var filled_in = anti_contradiction_template.replace( "INSERT_16_BYTE_HERE", hash_pair[ 0 ] ).replace( "INSERT_17_BYTE_HERE", hash_pair[ 1 ] );
                    var leaf = filled_in.replaceAll( "\n\n", "\n" ).replaceAll( " ", "" ).split( "\n" );
                    leaf.splice( 0, 1 );
                    leaf.splice( leaf.length - 1, 1 );
                    anti_contradiction_scripts.push( leaf );
                });

                subsequent_commitment_hashes.forEach( hash_pair => {
                    var filled_in = anti_contradiction_template.replace( "INSERT_16_BYTE_HERE", hash_pair[ 0 ] ).replace( "INSERT_17_BYTE_HERE", hash_pair[ 1 ] );
                    var leaf = filled_in.replaceAll( "\n\n", "\n" ).replaceAll( " ", "" ).split( "\n" );
                    leaf.splice( 0, 1 );
                    leaf.splice( leaf.length - 1, 1 );
                    anti_contradiction_scripts.push( leaf );
                });

                var last_leaf = [
                    "OP_10",
                    "OP_CHECKSEQUENCEVERIFY",
                    "OP_DROP",
                    pubkey,
                    "OP_CHECKSIG"
                ];

                anti_contradiction_scripts.push( last_leaf );

                var tree = anti_contradiction_scripts.map( s => tapscript.Tap.encodeScript( s ) );
                var selected_script = anti_contradiction_scripts[ 0 ];
                anti_contradiction_script = selected_script;
                anti_contradiction_tapleaf = tapscript.Tap.encodeScript( anti_contradiction_script );
                var target = tapscript.Tap.encodeScript( selected_script );
                var pubkey = "ab".repeat( 32 );
                var [ tpubkey, cblock ] = tapscript.Tap.getPubKey(pubkey, { tree, target });
                anti_contradiction_tpubkey = tpubkey;
                anti_contradiction_cblock = cblock;
                var anti_contradiction_address = tapscript.Address.p2tr.fromPubKey( tpubkey, network );
                return anti_contradiction_address;
            }

            var generateChallengeAddress = pubkey => {
                var templates = {}
                templates[ "OP_NOT_00" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NOT
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_NOT_01" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NOT
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_NOT_10" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NOT
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_NOT_11" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NOT
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_BOOLAND_000" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_BOOLAND
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_BOOLAND_001" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_BOOLAND
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_BOOLAND_010" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_BOOLAND
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_BOOLAND_011" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_BOOLAND
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_BOOLAND_100" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_BOOLAND
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_BOOLAND_101" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_BOOLAND
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_BOOLAND_110" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_BOOLAND
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_BOOLAND_111" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_BOOLAND
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_XOR_000" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_XOR_001" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_XOR_010" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_XOR_011" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_XOR_100" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_XOR_101" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_XOR_110" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_0
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;
                templates[ "OP_XOR_111" ] = `
                    OP_TOALTSTACK
                    OP_SHA256
                    INSERT_FIRST_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_SWAP
                    OP_SHA256
                    INSERT_SECOND_INPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_FROMALTSTACK
                    OP_SHA256
                    INSERT_OUTPUT_HERE
                    OP_EQUALVERIFY
                    OP_1
                    OP_NUMNOTEQUAL
                    OP_VERIFY
                    ${vickys_key}
                    OP_CHECKSIG
                `;

                var challenge_scripts = [];

                var i; for ( i=0; i<operations_array.length; i++ ) {
                    if ( operations_array[ i ][ 0 ] == "INV" ) {
                        var input_hash_pair = [ operations_array[ i ][ 3 ][ 1 ], operations_array[ i ][ 3 ][ 2 ] ];
                        var output_hash_pair = [ operations_array[ i ][ 4 ][ 1 ], operations_array[ i ][ 4 ][ 2 ] ];
                        var filled_in_templates = [];
                        filled_in_templates.push(
                            templates[ "OP_NOT_00" ].replace( "INSERT_INPUT_HERE", input_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_NOT_01" ].replace( "INSERT_INPUT_HERE", input_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] ),
                            templates[ "OP_NOT_10" ].replace( "INSERT_INPUT_HERE", input_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_NOT_11" ].replace( "INSERT_INPUT_HERE", input_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] )
                        );
                        filled_in_templates.forEach( template => {
                            var leaf = template.replaceAll( "\n\n", "\n" ).replaceAll( " ", "" ).split( "\n" );
                            leaf.splice( 0, 1 );
                            leaf.splice( leaf.length - 1, 1 );
                            challenge_scripts.push( leaf );
                        });
                    }
                    if ( operations_array[ i ][ 0 ] == "AND" ) {
                        var first_hash_pair = [ operations_array[ i ][ 4 ][ 1 ], operations_array[ i ][ 4 ][ 2 ] ];
                        var second_hash_pair = [ operations_array[ i ][ 5 ][ 1 ], operations_array[ i ][ 5 ][ 2 ] ];
                        var output_hash_pair = [ operations_array[ i ][ 6 ][ 1 ], operations_array[ i ][ 6 ][ 2 ] ];
                        var filled_in_templates = [];
                        filled_in_templates.push(
                            templates[ "OP_BOOLAND_000" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 0 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_BOOLAND_001" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 0 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] ),
                            templates[ "OP_BOOLAND_010" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 0 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_BOOLAND_011" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 0 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] ),
                            templates[ "OP_BOOLAND_100" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 1 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_BOOLAND_101" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 1 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] ),
                            templates[ "OP_BOOLAND_110" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 1 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_BOOLAND_111" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 1 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] ),
                        );
                        filled_in_templates.forEach( template => {
                            var leaf = template.replaceAll( "\n\n", "\n" ).replaceAll( " ", "" ).split( "\n" );
                            leaf.splice( 0, 1 );
                            leaf.splice( leaf.length - 1, 1 );
                            challenge_scripts.push( leaf );
                        });
                    }
                    if ( operations_array[ i ][ 0 ] == "XOR" ) {
                        var first_hash_pair = [ operations_array[ i ][ 4 ][ 1 ], operations_array[ i ][ 4 ][ 2 ] ];
                        var second_hash_pair = [ operations_array[ i ][ 5 ][ 1 ], operations_array[ i ][ 5 ][ 2 ] ];
                        var output_hash_pair = [ operations_array[ i ][ 6 ][ 1 ], operations_array[ i ][ 6 ][ 2 ] ];
                        var filled_in_templates = [];
                        filled_in_templates.push(
                            templates[ "OP_XOR_000" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 0 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_XOR_001" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 0 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] ),
                            templates[ "OP_XOR_010" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 0 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_XOR_011" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 0 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] ),
                            templates[ "OP_XOR_100" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 1 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_XOR_101" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 1 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 0 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] ),
                            templates[ "OP_XOR_110" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 1 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 0 ] ),
                            templates[ "OP_XOR_111" ].replace( "INSERT_FIRST_INPUT_HERE", first_hash_pair[ 1 ] ).replace( "INSERT_SECOND_INPUT_HERE", second_hash_pair[ 1 ] ).replace( "INSERT_OUTPUT_HERE", output_hash_pair[ 1 ] ),
                        );
                        filled_in_templates.forEach( template => {
                            var leaf = template.replaceAll( "\n\n", "\n" ).replaceAll( " ", "" ).split( "\n" );
                            leaf.splice( 0, 1 );
                            leaf.splice( leaf.length - 1, 1 );
                            challenge_scripts.push( leaf );
                        });
                    }
                }

                var last_leaf = [
                    "OP_10",
                    "OP_CHECKSEQUENCEVERIFY",
                    "OP_DROP",
                    pubkey,
                    "OP_CHECKSIG"
                ];

                challenge_scripts.push( last_leaf );

                var tree = challenge_scripts.map( s => tapscript.Tap.encodeScript( s ) );
                var selected_script = challenge_scripts[ challenge_scripts.length - 1 ];
                challenge_script = selected_script;
                challenge_tapleaf = tapscript.Tap.encodeScript( challenge_script );
                var target = tapscript.Tap.encodeScript( selected_script );
                var pubkey = "ab".repeat( 32 );
                var [ tpubkey, cblock ] = tapscript.Tap.getPubKey(pubkey, { tree, target });
                challenge_tpubkey = tpubkey;
                challenge_cblock = cblock;
                var challenge_address = tapscript.Address.p2tr.fromPubKey( tpubkey, network );
                return challenge_address;
            }

            var generateFundingAddress = pubkey => {
                var funding_scripts = [];

                var first_leaf = [
                    "OP_10",
                    "OP_CHECKSEQUENCEVERIFY",
                    "OP_DROP",
                    pubkey,
                    "OP_CHECKSIG"
                ];

                funding_scripts.push( first_leaf );

                var second_leaf = [
                    "OP_0",
                    pubkey,
                    "OP_CHECKSIGADD",
                    vickys_key,
                    "OP_CHECKSIGADD",
                    "OP_2",
                    "OP_EQUAL"
                ];

                funding_scripts.push( second_leaf );

                var tree = funding_scripts.map( s => tapscript.Tap.encodeScript( s ) );
                var selected_script = funding_scripts[ 0 ];
                funding_to_anywhere_else_script = funding_scripts[ 1 ];
                funding_to_paul_script = selected_script;
                funding_to_paul_tapleaf = tapscript.Tap.encodeScript( funding_to_paul_script );
                funding_to_anywhere_else_tapleaf = tapscript.Tap.encodeScript( funding_to_anywhere_else_script );
                var target = tapscript.Tap.encodeScript( selected_script );
                var pubkey = "ab".repeat( 32 );
                var [ tpubkey, cblock ] = tapscript.Tap.getPubKey(pubkey, { tree, target });
                funding_to_paul_tpubkey = tpubkey;
                funding_to_paul_cblock = cblock;
                var [ tpubkey, alt_cblock ] = tapscript.Tap.getPubKey(pubkey, { tree, funding_to_anywhere_else_tapleaf });
                funding_to_anywhere_else_cblock = alt_cblock;
                var funding_address = tapscript.Address.p2tr.fromPubKey( tpubkey, network );
                return funding_address;
            }

            var waitSomeSeconds = num => {
                var num = num.toString() + "000";
                num = Number( num );
                return new Promise( resolve => setTimeout( resolve, num ) );
            }

            async function addressOnceHadMoney( address, network ) {
                var nonjson = await getData( "https://mutinynet.com/" + network + "api/address/" + address );
                var json = JSON.parse( nonjson );
                if ( json[ "chain_stats" ][ "tx_count" ] > 0 || json[ "mempool_stats" ][ "tx_count" ] > 0 ) return true;
                return false;
            }

            async function loopTilAddressReceivesMoney( address, network ) {
                var itReceivedMoney = false;
                async function isDataSetYet( data_i_seek ) {
                    return new Promise( ( resolve, reject ) => {
                        if ( !data_i_seek ) {
                            setTimeout( async () => {
                                console.log( "waiting for address to receive money..." );
                                try {
                                    itReceivedMoney = await addressOnceHadMoney( address, network );
                                }catch(e){}
                                var msg = await isDataSetYet( itReceivedMoney );
                                resolve( msg );
                            }, 2000);
                        } else {
                            resolve( data_i_seek );
                        }
                    });
                }

                async function getTimeoutData() {
                    var data_i_seek = await isDataSetYet(itReceivedMoney);
                    return data_i_seek;
                }

                let returnable = await getTimeoutData();
                return returnable;
            }

            async function addressReceivedMoneyInThisTx( address, network ) {
                var txid;
                var vout;
                var amt;
                var nonjson = await getData( "https://mutinynet.com/" + network + "api/address/" + address + "/txs" );
                var json = JSON.parse( nonjson );
                json.forEach( tx => {
                    tx["vout"].forEach(function ( output, index ) {
                        if ( output["scriptpubkey_address"] == address ) {
                            txid = tx["txid"];
                            vout = index;
                            amt = output["value"];
                        }
                    });
                });
                return [txid, vout, amt];
            }

            function getData( url ) {
                return new Promise( async function( resolve, reject ) {
                    function inner_get( url ) {
                        var xhttp = new XMLHttpRequest();
                        xhttp.open( "GET", url, true );
                        xhttp.send();
                        return xhttp;
                    }
                    var data = inner_get( url );
                    data.onerror = function( e ) {
                        resolve( "error" );
                    }
                    async function isResponseReady() {
                        return new Promise( function( resolve2, reject ) {
                            if ( !data.responseText || data.readyState != 4 ) {
                                setTimeout( async function() {
                                    var msg = await isResponseReady();
                                    resolve2( msg );
                                }, 1 );
                            } else {
                                resolve2( data.responseText );
                            }
                        });
                    }
                    var returnable = await isResponseReady();
                    resolve( returnable );
                });
            }
            function pushBTCpmt( rawtx ) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if ( this.readyState == 4 && ( this.status > 199 && this.status < 300 ) ) {
                        var response = this.responseText;
                        console.log( "Your transaction was broadcasted, your txid is: " + response );
                    }
                };
                xhttp.open( "POST", "https://mutinynet.com/api/tx", true );
                xhttp.send( rawtx );
            }
            async function getBlockheight( network ) {
                var data = await getData( `https://mutinynet.com/${network}api/blocks/tip/height` );
                return Number( data );
            }
        </script>
        <script>
            var network = "testnet";
            if ( $_GET[ "network" ] == "regtest" ) network = "regtest";
            var arrprep = ``;
            var arr = [];
            var number_of_preimages_to_expect = null;
            var number_of_inputs = null;
            var number_of_outputs = null;
            var wire_settings = {}
            var operations_array = [];
            var initial_commitment_preimages = [];
            var initial_commitment_hashes = [];
            var subsequent_commitment_preimages = [];
            var subsequent_commitment_hashes = [];
            var funding_address = null;
            var funding_to_paul_tpubkey = null;
            var funding_to_paul_tapleaf = null;
            var funding_to_anywhere_else_tapleaf = null;
            var funding_to_paul_cblock = null;
            var funding_to_paul_script = null;
            var funding_to_anywhere_else_script = null;
            var funding_to_anywhere_else_cblock = null;
            var bit_commitment_address = null;
            var bit_commitment_tpubkey = null;
            var bit_commitment_tapleaf = null;
            var bit_commitment_cblock = null;
            var bit_commitment_script = null;
            var commitment_to_anywhere_else_tapleaf = null;
            var commitment_to_anywhere_else_script = null;
            var commitment_to_anywhere_else_cblock = null;
            var anti_contradiction_address = null;
            var anti_contradiction_tpubkey = null;
            var anti_contradiction_cblock = null;
            var anti_contradiction_tapleaf = null;
            var anti_contradiction_script = null;
            var challenge_address = null;
            var challenge_tpubkey = null;
            var challenge_tapleaf = null;
            var challenge_cblock = null;
            var challenge_script = null;
            var privkey = getRand( 32 );
            var pubkey = nobleSecp256k1.getPublicKey( privkey, true ).substring( 2 );
            var starter_address = tapscript.Address.p2tr.encode( pubkey, network );
            var vickys_key = null;
            var starter_txid = null;
            var starter_vout = null;
            var starter_amt = null;
            var presigned_tx_sigs = {}
            var earnings_txhex = null;
            var preimages_to_reveal = [];
            var wires = [];
            var promise = null;
        </script>
    </head>
    <body>
        <div class="home">
            <h1>Welcome to BitVM Online</h1>
            <p>To run the bitvm there are seven steps:</p>
            <ol>
                <li>Pick a program</li>
                <li>Act as the prover to commit to a certain output</li>
                <li>Send money to the program</li>
                <li>Act as the prover to share which "inputs" make the code produce the expected output</li>
                <li>Act as the verifier to check if the code, with those inputs, produces the expected output</li>
                <li>If they do, act as the prover to take the money after a timelock</li>
                <li>Otherwise, act as the verifier to take the money by producing the error</li>
            </ol>
            <h2>Pick a program you want to run</h2>
            <p><button class="view_zero_checker p_buttons">Zero checker</button> <button class="view_size_checker p_buttons" disabled>Size checker (coming soon)</button> <button class="view_addition p_buttons" disabled>Addition (coming soon)</button></p>
            <div class="zero_checker hidden">
                <h3 class="zero_checker_label">
                    Zero checker
                </h3>
                <div class="zero_checker_instructions">
                    In this program, the prover must share a string of numbers with the verifier within a time limit, but not before making one of two promises: the string will only be 0s, or the string will *not* only be zeros. The verifier can take the prover's money if the promise is broken.
                </div>
                <p><button class="choose_zero_checker">Choose this program</button></p>
            </div>
            <div class="size_checker hidden">
                <h3 class="size_checker_label">
                    Size checker
                </h3>
                <div class="size_checker_instructions">
                    In this program, the prover must share a number with the verifier, then make one of two promises: within a time limit, they will share (1) a number that is less than or equal to the original number, or (2) a number that is greater than the original number. The verifier can take the prover's money if the promise is broken.
                </div>
                <p><button class="choose_size_checker">Choose this program</button></p>
            </div>
            <div class="addition hidden">
                <h3 class="addition_label">
                    Addition
                </h3>
                <div class="addition_instructions">
                    In this program, the prover must share a number with the verifier, then make a promise: within a time limit, they will share two numbers that sum to the original number. The verifier can take the prover's money if the promise is broken.
                </div>
                <p><button class="choose_addition">Choose this program</button></p>
            </div>
        </div>
        <div class="zero_checker_program program hidden">
            <h1>Zero checker</h1>
            <div class="zero_checker_step_one">
                <p>
                    In this demo you will play as Paul, the prover. The first step is to open up the page where Vicky -- the verifier -- will verify your program, and copy her public key, and paste it here
                </p>
                <p>Visit Vicky's page: <a class="vicky_link" href="./vicky.html" target="_blank">Vicky page</a></p>
                <script>
                    $( '.vicky_link' ).href = "./vicky.html";
                    if ( $_GET[ "network" ] ) $( '.vicky_link' ).href = `./vicky.html?network=${$_GET[ "network" ]}`;
                </script>
                <p>Enter Vicky's public key</p>
                <p><input class="vickys_key"></p>
                <p><button class="zero_checker_step_one_done">Done</button></p>
            </div>
            <div class="zero_checker_step_two hidden">
                <p>
                    Time to make a promise to Vicky! Will your string be all 0s or not all zeros?
                </p>
                <select class="all_or_none">
                    <option>All 0s</option>
                    <option>Not all 0s</option>
                </select>
                <p><button class="submit_all_or_none">Download your promise file</button></p>
                <p>
                    Click ok when you've sent the promise file to Vicky
                </p>
                <p><button class="zero_checker_step_two_done">Done</button></p>
            </div>
            <div class="zero_checker_step_three hidden">
                <p>
                    Time to validate that you and Vicky generated the same bitcoin addresses. Do all of these match what Vicky got? (Note: don't send any money to them yet)
                </p>
                <div class="address_validation">loading...</div>
                <p><button class="zero_checker_step_three_done">Yes, they match</button> <button class="zero_checker_step_three_reset">No, they don't match</button></p>
            </div>
            <div class="zero_checker_step_four hidden">
                <p>
                    Send *PRECISELY* 10,000 sats to the following address to start the contract (if you send the wrong amount it will not work):
                </p>
                <div class="funding_address_in_step_four">loading...</div>
                <p class="asking_for_txid">Asking for txid and vout in 3 seconds</p>
            </div>
            <div class="zero_checker_step_five hidden">
                <p>
                    Broadcast the following transaction to finalize the contract:
                </p>
                <div class="starter_txhex">loading...</div>
                <p><button class="zero_checker_step_five_done">Done</button></p>
            </div>
            <div class="zero_checker_step_six hidden">
                <p>
                    What string do you want to reveal to Vicky? Remember, you promised <span class="step_six_promise_to_vicky"></span> and she can take your money if you lie
                </p>
                <p><input class="zero_checker_revelation_string" maxlength="64" oninput="this.value=this.value.replace(/[^0-1]/,'')"></p>
                <p>Add this many more characters: <span class="zero_checker_chars_left">64</span></p>
                <p>Note that your string must only contain 0s and 1s</p>
                <p><button class="zero_checker_step_six_done">Submit</button></p>
            </div>
        </div>
        <script>
            $( '.view_zero_checker' ).onclick = () => {
                $( '.zero_checker' ).classList.remove( "hidden" );
                $( '.size_checker' ).classList.add( "hidden" );
                $( '.addition' ).classList.add( "hidden" );
            }
            $( '.view_size_checker' ).onclick = () => {
                $( '.zero_checker' ).classList.add( "hidden" );
                $( '.size_checker' ).classList.remove( "hidden" );
                $( '.addition' ).classList.add( "hidden" );
            }
            $( '.view_addition' ).onclick = () => {
                $( '.zero_checker' ).classList.add( "hidden" );
                $( '.size_checker' ).classList.add( "hidden" );
                $( '.addition' ).classList.remove( "hidden" );
            }
            $( '.choose_zero_checker' ).onclick = async () => {
                $( '.zero_checker_program' ).classList.remove( "hidden" );
                $( '.home' ).classList.add( "hidden" );
                arrprep = `
                127 191
                1 64 
                1 1 

                1 1 63 65 INV
                1 1 60 64 INV
                2 1 65 64 69 AND
                1 1 62 67 INV
                1 1 61 66 INV
                2 1 67 66 68 AND
                2 1 69 68 77 AND
                1 1 51 71 INV
                1 1 48 70 INV
                2 1 71 70 75 AND
                1 1 50 73 INV
                1 1 49 72 INV
                2 1 73 72 74 AND
                2 1 75 74 76 AND
                2 1 77 76 93 AND
                1 1 59 79 INV
                1 1 56 78 INV
                2 1 79 78 83 AND
                1 1 58 81 INV
                1 1 57 80 INV
                2 1 81 80 82 AND
                2 1 83 82 91 AND
                1 1 55 85 INV
                1 1 52 84 INV
                2 1 85 84 89 AND
                1 1 54 87 INV
                1 1 53 86 INV
                2 1 87 86 88 AND
                2 1 89 88 90 AND
                2 1 91 90 92 AND
                2 1 93 92 125 AND
                1 1 15 95 INV
                1 1 12 94 INV
                2 1 95 94 99 AND
                1 1 14 97 INV
                1 1 13 96 INV
                2 1 97 96 98 AND
                2 1 99 98 107 AND
                1 1 3 101 INV
                1 1 0 100 INV
                2 1 101 100 105 AND
                1 1 2 103 INV
                1 1 1 102 INV
                2 1 103 102 104 AND
                2 1 105 104 106 AND
                2 1 107 106 123 AND
                1 1 11 109 INV
                1 1 8 108 INV
                2 1 109 108 113 AND
                1 1 10 111 INV
                1 1 9 110 INV
                2 1 111 110 112 AND
                2 1 113 112 121 AND
                1 1 7 115 INV
                1 1 4 114 INV
                2 1 115 114 119 AND
                1 1 6 117 INV
                1 1 5 116 INV
                2 1 117 116 118 AND
                2 1 119 118 120 AND
                2 1 121 120 122 AND
                2 1 123 122 124 AND
                2 1 125 124 189 AND
                1 1 47 127 INV
                1 1 44 126 INV
                2 1 127 126 131 AND
                1 1 46 129 INV
                1 1 45 128 INV
                2 1 129 128 130 AND
                2 1 131 130 139 AND
                1 1 35 133 INV
                1 1 32 132 INV
                2 1 133 132 137 AND
                1 1 34 135 INV
                1 1 33 134 INV
                2 1 135 134 136 AND
                2 1 137 136 138 AND
                2 1 139 138 155 AND
                1 1 43 141 INV
                1 1 40 140 INV
                2 1 141 140 145 AND
                1 1 42 143 INV
                1 1 41 142 INV
                2 1 143 142 144 AND
                2 1 145 144 153 AND
                1 1 39 147 INV
                1 1 36 146 INV
                2 1 147 146 151 AND
                1 1 38 149 INV
                1 1 37 148 INV
                2 1 149 148 150 AND
                2 1 151 150 152 AND
                2 1 153 152 154 AND
                2 1 155 154 187 AND
                1 1 31 157 INV
                1 1 28 156 INV
                2 1 157 156 161 AND
                1 1 30 159 INV
                1 1 29 158 INV
                2 1 159 158 160 AND
                2 1 161 160 169 AND
                1 1 19 163 INV
                1 1 16 162 INV
                2 1 163 162 167 AND
                1 1 18 165 INV
                1 1 17 164 INV
                2 1 165 164 166 AND
                2 1 167 166 168 AND
                2 1 169 168 185 AND
                1 1 27 171 INV
                1 1 24 170 INV
                2 1 171 170 175 AND
                1 1 26 173 INV
                1 1 25 172 INV
                2 1 173 172 174 AND
                2 1 175 174 183 AND
                1 1 23 177 INV
                1 1 20 176 INV
                2 1 177 176 181 AND
                1 1 22 179 INV
                1 1 21 178 INV
                2 1 179 178 180 AND
                2 1 181 180 182 AND
                2 1 183 182 184 AND
                2 1 185 184 186 AND
                2 1 187 186 188 AND
                2 1 189 188 190 AND
                `;
                makeBristolArray();
                await setOperationsArray();
                await generateBitCommitments();
                operations_array.forEach( ( operation, index ) => {
                    if ( operation[ 0 ] == "INV" ) subsequent_commitment_preimages.push( [ operation[ 2 ][ 1 ], operation[ 2 ][ 2 ] ] );
                    if ( operation[ 0 ] == "INV" ) subsequent_commitment_hashes.push( [ operation[ 4 ][ 1 ], operation[ 4 ][ 2 ] ] );
                    if ( operation[ 0 ] == "AND" ) subsequent_commitment_preimages.push( [ operation[ 3 ][ 1 ], operation[ 3 ][ 2 ] ] );
                    if ( operation[ 0 ] == "AND" ) subsequent_commitment_hashes.push( [ operation[ 6 ][ 1 ], operation[ 6 ][ 2 ] ] );
                    if ( operation[ 0 ] == "XOR" ) subsequent_commitment_preimages.push( [ operation[ 3 ][ 1 ], operation[ 3 ][ 2 ] ] );
                    if ( operation[ 0 ] == "XOR" ) subsequent_commitment_hashes.push( [ operation[ 6 ][ 1 ], operation[ 6 ][ 2 ] ] );
                });
            }
            $( '.zero_checker_step_one_done' ).onclick = () => {
                $( '.zero_checker_step_one' ).classList.add( "hidden" );
                $( '.zero_checker_step_two' ).classList.remove( "hidden" );
                vickys_key = $( '.vickys_key' ).value;
            }
            $( '.submit_all_or_none' ).onclick = () => {
                promise = $( '.all_or_none' ).value;
                if ( promise == "All 0s" ) {
                    output_preimages = [ subsequent_commitment_preimages[ subsequent_commitment_preimages.length - 1 ][ 1 ] ];
                } else {
                    output_preimages = [ subsequent_commitment_preimages[ subsequent_commitment_preimages.length - 1 ][ 0 ] ];
                }
                var message_to_vicky = {
                    program: "zero checker",
                    promise,
                    pauls_key: pubkey,
                    initial_commitment_hashes,
                    subsequent_commitment_hashes,
                    output_preimages
                }
                saveData( JSON.stringify( message_to_vicky ), "promise_file.txt" );
            }
            $( '.zero_checker_step_two_done' ).onclick = () => {
                $( '.zero_checker_step_one' ).classList.add( "hidden" );
                $( '.zero_checker_step_two' ).classList.add( "hidden" );
                $( '.zero_checker_step_three' ).classList.remove( "hidden" );
                promise = $( '.all_or_none' ).value;
                $( '.step_six_promise_to_vicky' ).innerText = promise.toLowerCase();
                bit_commitment_address = generateBitCommitmentAddress( pubkey );
                anti_contradiction_address = generateAntiContradictionAddress( pubkey );
                challenge_address = generateChallengeAddress( pubkey );
                funding_address = generateFundingAddress( pubkey );
                var html = `
                    <p>Funding address: ${funding_address}</p>
                    <p>Bit commitment address: ${bit_commitment_address}</p>
                    <p>Anti contradiction address: ${anti_contradiction_address}</p>
                    <p>Challenge address: ${challenge_address}</p>
                `;
                $( '.address_validation' ).innerHTML = html;
            }
            $( '.zero_checker_step_three_reset' ).onclick = () => {
                alert( `Something must have gone wrong so it is not safe to continue. The page will reset.` );
                window.location.reload();
            }
            $( '.zero_checker_step_three_done' ).onclick = async () => {
                $( '.zero_checker_step_one' ).classList.add( "hidden" );
                $( '.zero_checker_step_two' ).classList.add( "hidden" );
                $( '.zero_checker_step_three' ).classList.add( "hidden" );
                $( '.zero_checker_step_four' ).classList.remove( "hidden" );
                $( '.funding_address_in_step_four' ).innerText = starter_address;
                console.log( "starter address:", starter_address );
                $( '.asking_for_txid' ).innerHTML = `If you are looking for testnet coins, try this faucet: <a href="https://faucet.mutinynet.com/" target="_blank">https://faucet.mutinynet.com</a>`;
                await waitSomeSeconds( 3 );
                if ( $_GET[ "network" ] == "regtest" ) {
                    var txid = prompt( `What was the txid?` );
                    var vout = prompt( `And the vout?` );
                    vout = Number( vout );
                } else {
                    await loopTilAddressReceivesMoney( starter_address, "" );
                    await waitSomeSeconds( 2 );
                    var txinfo = await addressReceivedMoneyInThisTx( starter_address, "" );
                    var txid = txinfo[ 0 ];
                    var vout = txinfo[ 1 ];
                }
                $( '.zero_checker_step_four' ).classList.add( "hidden" );
                $( '.zero_checker_step_five' ).classList.remove( "hidden" );
                var amt = 10_000;
                var starter_txdata = tapscript.Tx.create({
                  vin  : [{
                    txid: txid,
                    vout: vout,
                    prevout: {
                      value: amt,
                      scriptPubKey: [ 'OP_1', pubkey ]
                    },
                  }],
                  vout : [{
                    value: amt - 500,
                    scriptPubKey: tapscript.Address.toScriptPubKey( funding_address ),
                  }]
                });

                var starter_sig = tapscript.Signer.taproot.sign( privkey, starter_txdata, 0 );
                starter_txdata.vin[0].witness = [ starter_sig ];
                await tapscript.Signer.taproot.verify( starter_txdata, 0, { throws: true });
                var starter_txhex = tapscript.Tx.encode( starter_txdata ).hex;
                starter_txid = tapscript.Tx.util.getTxid( starter_txhex );
                starter_vout = 0;
                starter_amt = 9_500;
                var destino = prompt( `Please enter a bitcoin address where you want your earnings to go` );
                var earnings_txdata = tapscript.Tx.create({
                  vin: [{
                    txid: starter_txid,
                    vout: starter_vout,
                    sequence: 10,
                    prevout: {
                      value: starter_amt,
                      scriptPubKey: tapscript.Address.toScriptPubKey( funding_address )
                    },
                  }],
                  vout: [{
                    value: starter_amt - 500,
                    scriptPubKey: tapscript.Address.toScriptPubKey( destino ),
                  }],
                });
                var earnings_sig = tapscript.Signer.taproot.sign( privkey, earnings_txdata, 0, { extension: funding_to_paul_tapleaf } );
                earnings_txdata.vin[0].witness = [ earnings_sig, funding_to_paul_script, funding_to_paul_cblock ];
                await tapscript.Signer.taproot.verify( earnings_txdata, 0, { pubkey, throws: true });
                earnings_txhex = tapscript.Tx.encode( earnings_txdata ).hex;
                //presign (1) a tx from the funding address to the bit commitment
                //address (2) a tx from the bit commitment address to the anti-contradiction
                //address (3) a tx from the bit commitment address to the challenge address
                //(4) a tx from the funding address to the anti-contradiction address (5)
                //a tx from the funding address to the challenge address
                //todo: Paul shouldn't put his money in the funding address til he has
                //validated sigs from Vicky letting him move his money *out of* the bit
                //commitment addresses and into the challenge address. Otherwise Vicky
                //might put his money *in* the bit commitment address but never let him
                //take it out.
                var funding_to_bit_commitment_txdata = tapscript.Tx.create({
                  vin: [{
                    txid: starter_txid,
                    vout: starter_vout,
                    prevout: {
                      value: starter_amt,
                      scriptPubKey: tapscript.Address.toScriptPubKey( funding_address )
                    },
                  }],
                  vout: [{
                    value: starter_amt - 500,
                    scriptPubKey: tapscript.Address.toScriptPubKey( bit_commitment_address ),
                  }],
                });
                var funding_to_bit_commitment_sig = tapscript.Signer.taproot.sign( privkey, funding_to_bit_commitment_txdata, 0, { extension: funding_to_anywhere_else_tapleaf } );
                var funding_to_anti_contradiction_txdata = tapscript.Tx.create({
                  vin: [{
                    txid: starter_txid,
                    vout: starter_vout,
                    prevout: {
                      value: starter_amt,
                      scriptPubKey: tapscript.Address.toScriptPubKey( funding_address )
                    },
                  }],
                  vout: [{
                    value: starter_amt - 500,
                    scriptPubKey: tapscript.Address.toScriptPubKey( anti_contradiction_address ),
                  }],
                });
                var funding_to_anti_contradiction_sig = tapscript.Signer.taproot.sign( privkey, funding_to_anti_contradiction_txdata, 0, { extension: funding_to_anywhere_else_tapleaf } );
                var funding_to_challenge_txdata = tapscript.Tx.create({
                  vin: [{
                    txid: starter_txid,
                    vout: starter_vout,
                    prevout: {
                      value: starter_amt,
                      scriptPubKey: tapscript.Address.toScriptPubKey( funding_address )
                    },
                  }],
                  vout: [{
                    value: starter_amt - 500,
                    scriptPubKey: tapscript.Address.toScriptPubKey( challenge_address ),
                  }],
                });
                var funding_to_challenge_sig = tapscript.Signer.taproot.sign( privkey, funding_to_challenge_txdata, 0, { extension: funding_to_anywhere_else_tapleaf } );
                var to_commitment_txhex = tapscript.Tx.encode( funding_to_bit_commitment_txdata ).hex;
                var to_commitment_txid = tapscript.Tx.util.getTxid( to_commitment_txhex );
                var to_commitment_vout = 0;
                var to_commitment_amt = 9_000;
                var commitment_to_anti_contradiction_txdata = tapscript.Tx.create({
                  vin: [{
                    txid: to_commitment_txid,
                    vout: to_commitment_vout,
                    prevout: {
                      value: to_commitment_amt,
                      scriptPubKey: tapscript.Address.toScriptPubKey( bit_commitment_address )
                    },
                  }],
                  vout: [{
                    value: to_commitment_amt - 3000,
                    scriptPubKey: tapscript.Address.toScriptPubKey( anti_contradiction_address ),
                  }],
                });
                var commitment_to_anti_contradiction_sig = tapscript.Signer.taproot.sign( privkey, commitment_to_anti_contradiction_txdata, 0, { extension: commitment_to_anywhere_else_tapleaf } );
                var commitment_to_challenge_txdata = tapscript.Tx.create({
                  vin: [{
                    txid: to_commitment_txid,
                    vout: to_commitment_vout,
                    prevout: {
                      value: to_commitment_amt,
                      scriptPubKey: tapscript.Address.toScriptPubKey( bit_commitment_address )
                    },
                  }],
                  vout: [{
                    value: to_commitment_amt - 3000,
                    scriptPubKey: tapscript.Address.toScriptPubKey( challenge_address ),
                  }],
                });
                var commitment_to_challenge_sig = tapscript.Signer.taproot.sign( privkey, commitment_to_challenge_txdata, 0, { extension: commitment_to_anywhere_else_tapleaf } );
                console.log( "starter txhex:", starter_txhex, "earnings_txhex:", earnings_txhex );
                //get the txid, vout, and amount left over from the starter tx and send them
                //to Vicky, then send the money into the funding address, then do the
                //computation and send Vicky the preimages and the signatures and the txid/
                //vout/amount of the tx from the starter address to the funding address
                //todo: prover shouldn't send his money anywhere til he gets paid to do so
                //by Vicky -- e.g. in an atomic swap where she gives him 5000 sats if he
                //puts his money in the funding address -- but she shouldn't do that til
                //she has the ability to move his money from the funding address to all of
                //these other addresses, so she should validate his signatures before doing
                //that swap. She should also independently construct all the txs above so
                //she has an independent copy of the sighashes to compare each sig against
                $( '.starter_txhex' ).innerText = starter_txhex;
                setTimeout( () => {pushBTCpmt( starter_txhex, "" );}, 2000 );
                $( '.zero_checker_step_five_done' ).click();
                presigned_tx_sigs = {
                    funding_to_bit_commitment_sig: funding_to_bit_commitment_sig.hex,
                    funding_to_anti_contradiction_sig: funding_to_anti_contradiction_sig.hex,
                    funding_to_challenge_sig: funding_to_challenge_sig.hex,
                    commitment_to_anti_contradiction_sig: commitment_to_anti_contradiction_sig.hex,
                    commitment_to_challenge_sig: commitment_to_challenge_sig.hex,
                }
            }
            $( '.zero_checker_step_five_done' ).onclick = async () => {
                $( '.zero_checker_step_five' ).classList.add( "hidden" );
                $( '.zero_checker_step_six' ).classList.remove( "hidden" );
            }
            $( '.zero_checker_step_six_done' ).onclick = async () => {
                var string = $( '.zero_checker_revelation_string' ).value;
                var stringarr = string.split( "" );
                stringarr.forEach( ( item, index ) => stringarr[ index ] = Number( item ) );
                initial_commitment_preimages.forEach( ( preimage_pair, index ) => {
                    wires.push( stringarr[ index ] );
                    preimages_to_reveal.push( preimage_pair[ stringarr[ index ] ] );
                });
                var i; for ( i=0; i<operations_array.length; i++ ) {
                    var fn_to_run = operations_array[ i ][ operations_array[ i ].length - 1 ].split( "= " )[ 1 ];
                    var preimage_to_reveal = eval( fn_to_run );
                    var output_wire = Number( operations_array[ i ][ operations_array[ i ].length - 1 ].split( " " )[ 1 ].substring( 2 ) );
                    wires[ output_wire ] = preimage_to_reveal;
                    preimage_to_reveal = Number( preimage_to_reveal ) + 1;
                    if ( operations_array[ i ][ 0 ] == "INV" ) preimages_to_reveal.push( operations_array[ i ][ 2 ][ preimage_to_reveal ] );
                    if ( operations_array[ i ][ 0 ] == "AND" ) preimages_to_reveal.push( operations_array[ i ][ 3 ][ preimage_to_reveal ] );
                    if ( operations_array[ i ][ 0 ] == "XOR" ) preimages_to_reveal.push( operations_array[ i ][ 3 ][ preimage_to_reveal ] );
                }
                var message_to_vicky = {
                    msg_type: "results",
                    starter_info: {
                        starter_txid,
                        starter_vout,
                        starter_amt,
                    },
                    preimages_to_reveal,
                    signatures: presigned_tx_sigs,
                }
                alert( `You are about to be prompted to download a file called results_file.txt. Do so and send it to Vicky.` );
                var blockheight = await getBlockheight( "" );
                saveData( JSON.stringify( message_to_vicky ), "results_file.txt" );
                $( '.zero_checker_step_six' ).innerHTML = `<p>After 10 blocks (so in block <span class="current_blockheight">${blockheight + 11}</span>) <a href="https://mutinynet.com/tx/push" target="_blank">go here</a> and broadcast this tx to collect your money if you sent the right data to Vicky (otherwise, expect Vicky to take your money):</p><p>${earnings_txhex}</p><p>While you wait, you can view the current blockheight here: <a href="https://mutinynet.com" target="_blank">https://mutinynet.com</a> (mutinynet is a bitcoin testnet where blocks arrive about every 30 seconds).</p>`;
            }
            $( '.vickys_key' ).value = "";
            $( '.zero_checker_revelation_string' ).value = "";
            $( '.zero_checker_revelation_string' ).onchange = () => {
                var length = $( '.zero_checker_revelation_string' ).value.length;
                $( '.zero_checker_chars_left' ).innerText = `${64 - length}`;
            }
            $( '.zero_checker_revelation_string' ).onkeyup = () => {
                var length = $( '.zero_checker_revelation_string' ).value.length;
                $( '.zero_checker_chars_left' ).innerText = `${64 - length}`;
            }
        </script>
    </body>
</html>
